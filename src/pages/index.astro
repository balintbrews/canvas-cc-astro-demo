---
import { JsonApiClient } from "@drupal-api-client/json-api-client";
import { Jsona } from "jsona";

import { CANVAS_SITE_URL, CANVAS_PAGE_UUID } from "astro:env/server";

import Layout from "../layouts/layout.astro";
import Components from "../lib/Components.jsx";

import type { EntityTypeWithBundle } from "@drupal-api-client/json-api-client";
import type { CanvasPageResponse } from "../types/drupal-canvas";

const client = new JsonApiClient(CANVAS_SITE_URL, {
  serializer: new Jsona(),
  debug: true,
});

const response = (await client.getResource(
  "canvas_page--canvas_page" as EntityTypeWithBundle,
  CANVAS_PAGE_UUID,
)) as CanvasPageResponse;

const { title, components } = response;
---

<Layout title={`canvas-cc-astro-demo: ${title}`}>
  <Components client:load data={components} />
</Layout>
